# Лабораторная работа №2 (без звёздочки)

## Рәхим итегес!

![minecraft](https://github.com/user-attachments/assets/d085b42e-e520-4e65-84f6-911540d197a6)

## Dockerfile и practicies  
  
  Перед началом лабораторной работы мы решили, что стоит разобраться с тем, что вообще такое Dockerfile и почему стоит его использовать. Для этого мы изучили пару статей и одно видео на 20 минут от земляка. Мы прикрепили наши источники в конце лабораторной.  
  
  После небольшой сессии групповой поддержки, мы с командой отдохнули от первой лабораторной работы и присутпили к выполнению второй.  
  
  В Dockerfile, как и во многих других сферах, есть хорошие и плохие practicies.  
  
  **Плохие включают в себя:**  
> • Использование тега `:latest` при иницализации (меняется со дня на день, ненадёжно использовать);  
> • Установка ненужных пакетов (не минималистично и использует больше места, чем нужно);  
> • Хранение токена github в `dockerfile` (попадет в историю, что очень плохо для безопасности);  
> • В целом работа с github (нестабильность, может быть недоступен и тогда весь образ упадёт);  
> • И др.  
  
  Именно их мы будем избегать, а затем применять в выполнении задания :)  
  
## Пишем dockerfile c bad practicies

  Недолго думая, мы пришли к выводу, что лучшим и простым вариантом для нас будет вывод в файл `pәхим итегес`. И, как первую попытку, мы пытаемся как можно сильнее усложнить себе жизнь, используя плохие practicies.  

  Для начала мы вызываем на помощь github и `alpine:latest`. После этого сохраняем токен github, клонируем репозиторий, устанавливаем самые разные библиотеки (включая python3) и записываем в `new.py` единственную и неповторимую фразу `pәхим итегез`. Код выглядит так:  
  
  <img width="1280" height="414" alt="image" src="https://github.com/user-attachments/assets/cc6f3400-d2d7-48f9-b715-fbef83c2dc5e" />  

  Казалось бы, всё выполнено и в целом, мы уже показали, что не стоит использовать из списка выше. Однако при проверке работоспособности, сталкиваемся с проблемой и ошибкой:
```
git: 'python3' is not a git command. See 'git --help'.
```
  После этого в беседе нашей группы начался сущий кошмар...  
  
  На протяжении 2-х часов мы не могли понять, что делаем не так. Были предприняты меры по разным использованиям библиотек, их вариаций и перестановок. Dockerfile за Dockerfile, построение за построением, образ за образом. Мы даже успели спросить DeepSeek, чтобы он объяснил нам, что идёт не так, но даже он не знал. Но одну вещь мы смогли узнать у него точно: местоимения.  
  
  <img width="1223" height="641" alt="image" src="https://github.com/user-attachments/assets/dd4b176d-25f0-4c43-9392-8bcf14808e90" />  
  
  Теперь живём с мыслью, что DeepSeek использует местоимения он/оно.  
  
  Вернёмся к решению: в один момент мы решили просто попробовать перейти с `alpine` на `ubuntu`, как одно из импульсивных попыток справиться с этой ошибкой. На удивление, ничего не произошло, и наш конфиг продолжал выводить одно и то же. Однако мы заметили, что когда вызываем команды, сначала используется `git`, и только потом `python3`, и именно поэтому ничего не работает. Когда мы поменяли местами в файле библиотеки python3 и git, всё встало на свои места и код наконец-то запустился.  
  
  Нашей радости не было конца. Вот как выглядел код теперь:  

  <img width="1280" height="414" alt="image" src="https://github.com/user-attachments/assets/89c56b50-e1b3-44c1-915b-a0558130f79b" />  

  <img width="1280" height="450" alt="image" src="https://github.com/user-attachments/assets/0bab30f0-2d44-42a2-8941-8a8cdecc4d8e" />  

## Пишем Dockerfile с good practicies

  Научившись на ошибках прошлого, мы немного изменили файл и положили всё в 1 папку `ogo`, чтобы всё подтягивалось из контекста сборки. Кроме того, мы указали ту версию python, которую хотим видеть при сборке образа. В этот раз всё запустилось без проблем.  

  Вот как выглядит код теперь:  

  <img width="1280" height="447" alt="image" src="https://github.com/user-attachments/assets/fc7ebe14-ae18-4628-ab9a-1de12be51dc3" />  

  <img width="1280" height="582" alt="image" src="https://github.com/user-attachments/assets/2f90abfc-712e-4800-969d-c52c9641e819" />  

## Выводы

  После запуска обоих контейнеров, мы сделали вывод, что глобально поменялось 3 основные вещи:  
  
  **1. Воспроизводимость результата.**  
  > При хороших practicies наш файл теперь доступен локально и не подвержен нестабильным изменениям и коммитам из github. Кроме того, наш токен больше не досутпен для общего использования, а значит что мы не рискуем безопасностью :)  
  
  **2. Скорость работы.**  
  > После того, как мы убрали ненужные библиотеки из кода, он стал работать намного быстрее и запускаться за считанные секунды!  

  **3. Образ python.**  
  > Мы использовали slim-образ для python. Он весит намного меньше обычного образа, поэтому повышает скорость работы Dockerfile ещё больше.  

  **4. Больше не используем alpine.**  
  > Это, скорее, наш личный вывод, но мы слишком сильно устали, пока пытались решить проблему с alpine, чтобы снова работать с ним :)))

## Источники

1. [То самое видео](https://www.youtube.com/watch?v=krZ6LXNtGaU)
2. [Наша любимая статья про good practicies](https://docs.docker.com/build/building/best-practices/#dockerfile-instructions)
3. [Наша любимая статья про bad practicies](https://codefresh.io/blog/docker-anti-patterns/)
