# Лабораторная работа №3 (без звёздочки)

ПЕРВАЯ ЧАСТЬ
1. как мы ci/cd файл изучали
2. плохие practicies
3. как их потенциально можно исправить

ВТОРАЯ ЧАСТЬ
1. как мы приступали к работе и обнаружили, что нужен номер зарубежный
2. как получили номер
3. как настроили пайплайн

ТРЕТЬЯ ЧАСТЬ
1. как написали файл, что он делает
2. описание плохих practicies, почему это плохо и как это исправить
3. исправленный файл и то, как он работает теперь

КОНЕЦ

## Рәхим итегез!

<img width="233" height="300" alt="image" src="https://github.com/user-attachments/assets/35fbfafa-a6ec-4a87-8580-13a9a61e342d" />

## CI/CD файлы и с чем их едят  
  
  Перед началом лабораторной работы мы решили ознакомиться с тем, что вообще такое CI/CD файл и какие practicies лучше всего использовать (или не использовать).  

  CI/CD файлы отвечают за проверку кода и развёртку на сервере. Грубо говоря, когда мы пушаем что-то на гитхаб, то CI/CD файл начинает свою работу и проверяет залитый код. Если все проверки, которые мы положим в CI/CD файл, пройдут, тогда всё автоматически сохранится на сервер. Именно это мы будем использовать, чтобы в будущем написать свой pipeline на GitHub.  

  Есть несколько **плохих practicies**, которые часто допускают в файлах. Однако их использование в некоторых случаях может даже привести к тому, что CI/CD будет выглядеть как подобие вируса, которое крадёт данные!
  
  **Одними из таких practicies являются:**
> 1. Запуск всех тестов на каждое движение пользователя.  
> 2. Слишком сложный pipeline.  
> 3. Нарушения конфиденциальности.  
> 4. Плохая оптимизация.  
> 5. И другие!

  И так, после того как мы немного вникли в происходящее, можно приступать к работе. Жми на рычаг, Кронк!  

  <img width="640" height="360" alt="image" src="https://github.com/user-attachments/assets/b5ec2051-7e3f-4847-980b-d76140636725" />

## Первые трудности  

  > *Не тот рычаг...*

  Начало обещало быть достаточно простым — нужно было зарегистрироваться на GitLab или Jenkins, чтобы можно было настроить pipeline. Jenkins нам не очень сильно симпатизировал, поэтому решили работать на другом сервисе. Зайдя на GitLab мы столкнулись с первой незначительной проблемой: мы неправильно зарегистрировались.  

  Абсолютно случайно мы нажали не туда, и теперь мы стали многомиллионной компанией, которой очень нужен pipeline для корпоративной работы. Насколько бы заманчиво не звучала идея осуществить свой план по свержению компаний-гигантов, пришлось перерегистрироваться, после чего наши масштабы резко снизились до инди-разработчиков, которые используют GitLab в личных целях.  

  Но проблемы здесь не закончились! Так как сейчас наложены санкции, мы не могли создать pipeline и настроить всё так, как хотим, потому что GitLab требовал от нас подтверждения иностранного номера или кредитной карты. Мы очень не хотели входить в финансовые задолженности ради лабораторной работы *(насколько бы интересной она не была)*, поэтому пришлось искать обходные пути.  

  <img width="896" height="934" alt="image" src="https://github.com/user-attachments/assets/ed85c768-d279-4f1b-9b14-ff7dcd51a794" />  

  К счастью, у одной из наших участниц был знакомый зарубежом, чей номер мы могли спокойно экспулатировать для работы. После недолгих уговоров, он согласился (фото прилагается), и мы приступили к реализации.  

  <img width="614" height="209" alt="image" src="https://github.com/user-attachments/assets/151aa566-c448-4ac2-985a-5e73c7ce1214" />  

  <img width="1280" height="720" alt="image" src="https://github.com/user-attachments/assets/20210fd9-041e-43ac-94c4-3a03ca0a1e95" />  

## Попытки реализовать пайплайн  

  Слшедующим шагом была установка `gitlab-runner` на компьютер для корректной работы с docker compose и pipeline, которые у нас уже были в заготовке. Однако, проблемы продолжились — наш `gitlab-runner` устанавливался непонятно куда!  

  <img width="1280" height="720" alt="image" src="https://github.com/user-attachments/assets/ee6eed4b-c7cf-4f53-b01c-b4a06bbf6ef9" />  

  Выходила ошибка...  

  <img width="1280" height="720" alt="image" src="https://github.com/user-attachments/assets/6df0dc96-3908-414c-9177-1ef491d0c48f" />  

  За ошибкой...  

  <img width="1280" height="720" alt="image" src="https://github.com/user-attachments/assets/cd9aec87-63df-4bca-aed3-0561db12bc26" />  
  
  За ошибкой......  

  Мы были сбиты с толку. Ничего не работало, `gitlab-runner`, похоже, ненавидел именно нас. Удача улыбалась нам по ту сторону изгороди с ошибками, которую мы не могли преодолеть. Оставалась лишь вера в пользователей реддита и нейросети.  

  <img width="1280" height="720" alt="image" src="https://github.com/user-attachments/assets/0c0ba696-cced-4e94-ba78-e3de56156a30" />  

  Мы не готовы были сдаваться. Пусть мудрецы и не знают, что происходит, но мы здесь за идею, за драйв и эмоции от готовой работы, и мы готовы искать по всем далёким углам интернета, чтобы найти решение.  

  <img width="1280" height="720" alt="image" src="https://github.com/user-attachments/assets/50af1f02-f179-4fee-a485-2bacfa1cde08" />  

  Но вот он — луч просветления. Бог поверил в нас, увидел код и снизошёл, чтобы помочь. Мы победили, и это стоило того.

  Как мы поняли, ошибка была в том, что всё это время файл был в контейнере, а не на хосте, и поэтому там не отображался. Успех, слёзы счастья, вкус победы — всё это всткружило нам голову. Мы были вне себя от счастья.  

  Заменяем строчку с `volumes = ["/cache"]`, чтобы контейнеры не были изолированны и имели доступ к `docker` на хосте. Теперь внутренности выглядят так:  

  <img width="1280" height="720" alt="image" src="https://github.com/user-attachments/assets/7566df18-3d8f-49bd-a9a4-6d3e73df336d" />  

  Казалось бы, мы готовы перейти к следующему шагу. Осталось по мелочи, запустить наш runner и всё будет в шоколаде. *Как же мы ошибались...*  

  **КАРТИНКА 1**  

  Стена, казалось, выросла на пустом месте. Мы решили не включать в отчёт очередные логи на насколько сотен строк, где решаем эту проблему, но знайте, что проблема, оказывается, была связана с `tags` внутри CI/CD файла, который мы использовали для тестов.

  > Интересный факт: во время мучительных попыток решить проблему с установкой `gitlab-runner` мимо нас проходил мужчина в футболке с принтом ниже. Мы искренне восхитились его постироничной личности и принту, поэтому очень надеемся, что вас он так же вдохновит на великие деяния.

  **КАРТИНКА 2**  

## Пишем плохой CI/CD файл  

  Помучавшись с пайплайном, мы решили, что недостаточно усложнили себе жизнь, и приступили к написанию плохого CI/CD файла. Казалось бы, нет ничего сложного, и мы договорились сделать файлы в один вечер, чтобы уже на утро всё заставить работать. Но не тут-то было...  

  Одним из первых условий было наличие проверок всего возможного в начале файла, но это вызывало ошибку, которую мы решили выше, поэтому пришлось их убрать.  
  **КАРТИНКА 3**  

  Ошибка. Он стрелял, в него стреляли, и он упал лицом в лужу. Участницу нашей команды — Марию — это крайне не устроило. Промелькнула цитата, которую невозможно не включить в отчёт:  

  > Дон уважает своего докера. (c) Мария  

  Мы приняли решение немного изменить наш шаблон, и пришли к следующему варианту реализации плохого CI/CD файла:  

  В нём мы вставляем свои ключ и пароль, наивно понадеясь, что никто не захочет использовать это в своих корыстных целях. Затем используем `alpine:latest`, чтобы обновление замедляло процесс проверки кода, и очищаем весь кэш, который *очень* мешается. Напоследок, максимально испортим оптимизацию pipeline, используя практически бесполезную команду. В итоге, у нас получается вот такой файл:  

  **КАРТИНКА 4**  
  **КАРТИНКА 5**  

  К счастью, всё запустилось и нам больше не нужно было переживать. Самое сложное позади. Удача, которая улыбалась нам в самом начале, наконец-то не казалась чем-то недостижимым.  

## Пишем хороший CI/CD файл  

  

## Источники

• [Хорошее видео про CI/CD](https://youtu.be/prOarIqL5Qs?si=PjxBc0KDhkzLeqC3)
